

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modifying files in python &mdash; Reproducible Computational Science  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="doit" href="../pydoit.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Reproducible Computational Science
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../reproducibility.html">What makes scientific results reproducible?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example.html">A complete, executable example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pydoit.html">doit</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modifying files in python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-ms-excel">Interacting with MS Excel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#open-a-worksheet">Open a worksheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reading-from-a-worksheet">Reading from a worksheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modifying-a-worksheet">Modifying a worksheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-cases">Use cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-ms-word">Interacting with MS Word</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Reproducible Computational Science</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Modifying files in python</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scripts/modify_files.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modifying-files-in-python">
<h1>Modifying files in python<a class="headerlink" href="#modifying-files-in-python" title="Permalink to this headline">¶</a></h1>
<p>Simple text files like <code class="docutils literal notranslate"><span class="pre">parameters.txt</span></code></p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">P1</span><span class="o">=</span><span class="mi">5</span>
<span class="n">P2</span><span class="o">=</span><span class="mi">17</span>
<span class="n">P5</span><span class="o">=</span><span class="mi">12</span>
</pre></div>
</td></tr></table></div>
<p>can easily be read (<code class="docutils literal notranslate"><span class="pre">&quot;r&quot;</span></code>) via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;parameters.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prm_file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">prm_file</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;P2&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[parameters.txt]  value of P2 is&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
<p>Other file formats like <a class="reference external" href="https://pyyaml.org/wiki/PyYAMLDocumentation">YAML</a> or
<a class="reference external" href="https://docs.python.org/3/library/json.html">JSON</a> offer a more convenient access. For example, modifying the <code class="docutils literal notranslate"><span class="pre">parameters.yaml</span></code></p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Material</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="n">E</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Young&#39;s modulus&quot;</span>
        <span class="n">value</span><span class="p">:</span> <span class="mf">20000.</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;MPa&quot;</span>
    <span class="n">nu</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Poission&#39;s ratio&quot;</span>
        <span class="n">value</span><span class="p">:</span> <span class="mf">0.2</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span>
    <span class="n">ft</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;tensile strength&quot;</span>
        <span class="n">value</span><span class="p">:</span> <span class="mf">4.</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;MPa&quot;</span>
        
<span class="n">Simulation</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="n">dt</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;time increment&quot;</span>
        <span class="n">value</span><span class="p">:</span> <span class="mf">0.1</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span>

</pre></div>
</td></tr></table></div>
<p>requires <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">pyyaml</span></code> and is done by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;parameters.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prm_file</span><span class="p">:</span>
    <span class="n">prm</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">prm_file</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
<span class="n">prm_E</span> <span class="o">=</span> <span class="n">prm</span><span class="p">[</span><span class="s2">&quot;Material parameters&quot;</span><span class="p">][</span><span class="s2">&quot;E&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">prm_E</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MPa&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[parameters.yaml] value of E is&quot;</span><span class="p">,</span> <span class="n">prm_E</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Writing YAML is done via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prm_E</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">17840.2</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;parameters_modified.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prm_file</span><span class="p">:</span>
    <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">prm</span><span class="p">,</span> <span class="n">prm_file</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Material</span> <span class="n">parameters</span><span class="p">:</span>
  <span class="n">E</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Young</span><span class="s1">&#39;s modulus</span>
    <span class="n">unit</span><span class="p">:</span> <span class="n">MPa</span>
    <span class="n">value</span><span class="p">:</span> <span class="mf">17840.2</span>
  <span class="n">ft</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">tensile</span> <span class="n">strength</span>
    <span class="n">unit</span><span class="p">:</span> <span class="n">MPa</span>
    <span class="n">value</span><span class="p">:</span> <span class="mf">4.0</span>
  <span class="n">nu</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Poission</span><span class="s1">&#39;s ratio</span>
    <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span>
    <span class="n">value</span><span class="p">:</span> <span class="mf">0.2</span>
<span class="n">Simulation</span> <span class="n">parameters</span><span class="p">:</span>
  <span class="n">dt</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">time</span> <span class="n">increment</span>
    <span class="n">unit</span><span class="p">:</span> <span class="n">s</span>
    <span class="n">value</span><span class="p">:</span> <span class="mf">0.1</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="interacting-with-ms-excel">
<h2>Interacting with MS Excel<a class="headerlink" href="#interacting-with-ms-excel" title="Permalink to this headline">¶</a></h2>
<p>A popular package that provides a <em>pythonic</em> representation of MS Excel
workbooks/worksheets is <a class="reference external" href="https://pypi.org/project/openpyxl/">openpyxl</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">openpyxl</span></code></p>
<div class="section" id="open-a-worksheet">
<h3>Open a worksheet<a class="headerlink" href="#open-a-worksheet" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/prm_xlsx.png" src="../_images/prm_xlsx.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openpyxl</span>

<span class="n">workbook</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="s2">&quot;parameters.xlsx&quot;</span><span class="p">)</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">active</span>
</pre></div>
</div>
<p>you can also select the worksheet by name</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">worksheet_by_name</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="s2">&quot;Tabelle1&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">worksheet</span> <span class="o">==</span> <span class="n">worksheet_by_name</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-from-a-worksheet">
<h3>Reading from a worksheet<a class="headerlink" href="#reading-from-a-worksheet" title="Permalink to this headline">¶</a></h3>
<p>You can either access cells by name …</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cell A6 contains:&quot;</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">[</span><span class="s2">&quot;A6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>… or by index.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cell (6,1) contains:&quot;</span><span class="p">,</span> <span class="n">worksheet</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">worksheet</span><span class="p">[</span><span class="s2">&quot;A6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">assert</span> <span class="n">worksheet</span><span class="p">[</span><span class="s2">&quot;A6&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">worksheet</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that openpyxl uses one-based-indexing. So in contrast to python lists or
numpy, where the first entry is <code class="docutils literal notranslate"><span class="pre">list[0]</span></code> or <code class="docutils literal notranslate"><span class="pre">numpy.array[0,0]</span></code>, the first
cell in the worksheet is <code class="docutils literal notranslate"><span class="pre">cell(1,1)</span></code>.</p>
<p>Openpyxl lets you conveniently loop through the cells of the worksheet, e.g.
to find the cell that containts “P2” and to access its right neighbor.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">worksheet</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;P2&quot;</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">column</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found P2 at cell:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cell right of P2 has value:&quot;</span><span class="p">,</span> <span class="n">worksheet</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-a-worksheet">
<h3>Modifying a worksheet<a class="headerlink" href="#modifying-a-worksheet" title="Permalink to this headline">¶</a></h3>
<p>Similar to reading cells, you can assign values by name or index.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">worksheet</span><span class="p">[</span><span class="s2">&quot;B11&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;P_new&quot;</span>
<span class="n">worksheet</span><span class="p">[</span><span class="s2">&quot;C11&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">17.0</span>
<span class="k">assert</span> <span class="n">worksheet</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mf">17.0</span>  <span class="c1"># C--&gt;3</span>
<span class="n">worksheet</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">6174.0</span>
</pre></div>
</div>
<p>Don’t forget to save the modified workbook.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">workbook</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;parameters_modified.xlsx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-cases">
<h3>Use cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h3>
<p>You can now get creative and write a function that finds the position of a
string within a worksheet …</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">row_col_of</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">parameter_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cell</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">column</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There is no cell containing &quot;</span><span class="si">{</span><span class="n">parameter_name</span><span class="si">}</span><span class="s1">&quot; in </span><span class="si">{</span><span class="n">ws</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>… to extract parameter values from the worksheet …</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">row_col_of</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;P2&quot;</span><span class="p">)</span>
<span class="n">P2_value</span> <span class="o">=</span> <span class="n">worksheet</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>and write it to a different file, e.g. by replacing a known placeholder with
the value. We therefore load a <code class="docutils literal notranslate"><span class="pre">base_input_file.dat</span></code> (containing the placeholders),</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>* This is a made-up input file for the 
* Tool &lt;ANSYS, ABACUS, you name it...&gt;
* that contains some fixed parameters,
* and some that can be defined within
* a workflow.

MESH     = &quot;bridge_fine.xdmf&quot;;
E        = 20000.0;
nu       = 0.3;
P2       = P2_PLACEHOLDER;
delta_t  = 0.1;
boundary = &quot;periodic&quot;;

...
</pre></div>
</td></tr></table></div>
<p>replace the
placeholder with our value from the Excel sheet and save it to a different file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;base_input_file.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">s_modified</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;P2_PLACEHOLDER&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">P2_value</span><span class="p">))</span>
<span class="nb">open</span><span class="p">(</span><span class="s2">&quot;input_file_modified.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s_modified</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="further-reading">
<h3>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt><a class="reference external" href="https://automatetheboringstuff.com/">Automate the boring stuff</a>, e.g.</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://automatetheboringstuff.com/2e/chapter9/">Chapter 9 Reading and writing files</a></p></li>
<li><p><a class="reference external" href="https://automatetheboringstuff.com/2e/chapter13/">Chapter 13 Working with Excel Spreadsheets</a></p></li>
</ul>
</dd>
</dl>
<p>Basic web searches like</p>
<blockquote>
<div><ul class="simple">
<li><p>“python read file”</p></li>
<li><p>“python loop through file line by line”</p></li>
<li><p>“python replace string in file”</p></li>
</ul>
<p>…</p>
<ul class="simple">
<li><p>will often lead you to <a class="reference external" href="https://stackoverflow.com/questions/4128144/replace-string-within-file-contents">stackoverflow.com</a></p></li>
<li><p>are often faster than reading whole tutorials</p></li>
<li><p>can result in ugly code, but that is OK.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="interacting-with-ms-word">
<h2>Interacting with MS Word<a class="headerlink" href="#interacting-with-ms-word" title="Permalink to this headline">¶</a></h2>
<p>One use case in reproducible science that works great in the context of
LaTeX files is the separation of text and images, where the images are
generated automatically in separate workflows. For MS Word, the challenge
is to update images of a document automatically.</p>
<p>A MS Word document is basically a zip file containing a text layer and a
picture layer. Those pictures are, if unzipped, stored in word/media and can
be accessed via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s2">&quot;report.docx&quot;</span><span class="p">)</span>
<span class="n">all_files</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;word/media/&quot;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now modify the contents (actually creating a new zip file) to replace
one of the images with another one. This is conveniently done by the provided
<code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">UpdatableZipFile</span></code> (web search: <em>python replace file in zip</em> lead to
<a class="reference external" href="https://stackoverflow.com/a/35435548">https://stackoverflow.com/a/35435548</a> )</p>
<p>You can direcly overwrite the <em>report.docx</em>, but we chose to work on a copy of
it (<em>report_modified.docx</em>) here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">updateable_zip_file</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;report.docx&quot;</span><span class="p">,</span> <span class="s2">&quot;report_modified.docx&quot;</span><span class="p">)</span>

<span class="n">new_images</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># order matters!</span>
    <span class="s2">&quot;dummy_images/red.png&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dummy_images/blue.png&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dummy_images/gray.png&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dummy_images/green.png&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">with</span> <span class="n">UpdateableZipFile</span><span class="p">(</span><span class="s2">&quot;report_modified.docx&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">o</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">new</span><span class="p">,</span> <span class="n">old</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_images</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span>
</pre></div>
</div>
<p>The big inconvenience is that you cannot recover the image names from
the *.docx file, so you have to rely on the ordering.</p>
<p><strong>Comment (TTitscher):</strong> As the MS Excel/Word is not part of my daily work, I
have no experience how the methods above perform in practice. However, I
believe that this topic is important and I suggest forming a working group
(lead by someone else) that investigates the methods further.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../pydoit.html" class="btn btn-neutral float-left" title="doit" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Thomas Titscher, Christoph Pohl

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>